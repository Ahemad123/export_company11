<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Products | Serani Export</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/chatbot.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
</head>

<body>

    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">
                    <img src="assets/images/logo.png" alt="Serani Export" style="height: 80px; width: auto;">
                </a>
                <div class="menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="about.html">About Us</a>
                    <a href="products.html" class="active">Products</a>
                    <a href="contact.html">Contact</a>
                    <a href="contact.html" class="btn btn-primary">Get a Quote</a>
                </div>
            </nav>
        </div>
    </header>

    <section class="section-padding">
        <div class="container">
            <div class="section-header text-center">
                <h1>Our Product Catalog</h1>
                <p>Explore our wide range of premium export goods.</p>
            </div>
            <div class="products-grid" id="products-container">
                <!-- Products will be loaded here dynamically -->
                <p class="text-center" style="grid-column: 1/-1;">Loading products...</p>
            </div>
        </div>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-col">
                <h3>Serani Export.</h3>
                <p>Connecting quality with opportunity.</p>
            </div>
            <div class="footer-col">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Contact</h4>
                <p><strong>Address : </strong><p>Langha Matam, Near Bukhari Masjid. Dhoraji, Rajkot, Gujarat-360410</p><br>
                <p><strong>Email : </strong><p><a href="contact.html">info@seraniexport.com</a></p><br>
                <p><strong>Mobile :</strong><p>+91 98765 43210</p>
            </div>
        </div>
        <div class="footer-bottom text-center">
            <p>&copy; 2025 Serani Export. All rights reserved.</p>
        </div>
    </footer>

    <!-- Chatbot Widget -->
    <button class="chatbot-toggler">
        <span class="material-symbols-outlined">mode_comment</span>
        <span class="material-symbols-outlined">close</span>
    </button>
    <div class="chatbot">
        <header>
            <h2>Serani Assistant</h2>
            <span class="close-btn material-symbols-outlined">close</span>
        </header>
        <ul class="chatbox">
            <li class="chat incoming">
                <span class="material-symbols-outlined">smart_toy</span>
                <p>Hi there ðŸ‘‹<br>How can I help you today?</p>
            </li>
        </ul>
        <div class="chat-input">
            <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
            <span id="send-btn" class="material-symbols-outlined">send</span>
        </div>
    </div>

    <script src="assets/js/chatbot.js"></script>
    <script>
        // Mobile Menu Toggle
        const mobileMenuBtn = document.querySelector('.menu-toggle');
        const navLinks = document.querySelector('.nav-links');

        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('products-container');
            // Check if loading indicator already exists
            let loadingIndicator = container.querySelector('p.text-center');
            if (!loadingIndicator) {
                loadingIndicator = document.createElement('p');
                loadingIndicator.className = 'text-center';
                loadingIndicator.style.gridColumn = '1/-1';
                loadingIndicator.textContent = 'Loading products...';
                container.appendChild(loadingIndicator);
            }

            let currentPage = 1;
            let isLoading = false;
            let hasMore = true;

            // Initial load
            loadProducts();

            // Infinite Scroll Observer
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting && !isLoading && hasMore) {
                    loadProducts();
                }
            }, {
                rootMargin: '100px'
            });

            observer.observe(loadingIndicator);

            function loadProducts() {
                if (isLoading || !hasMore) return;

                isLoading = true;

                fetch(`/api/products?page=${currentPage}&limit=6`)
                    .then(response => response.json())
                    .then(data => {
                        const products = data.products;
                        hasMore = data.hasMore;

                        // Remove loading indicator before appending new items
                        if (loadingIndicator.parentNode === container) {
                            container.removeChild(loadingIndicator);
                        }

                        products.forEach(product => {
                            const card = document.createElement('div');
                            card.className = 'product-card';
                            card.innerHTML = `
                                <img src="${product.image}" alt="${product.name}" class="product-img"
                                    style="width: 100%; height: 200px; object-fit: cover;">
                                <div class="product-info">
                                    <h3>${product.name}</h3>
                                    <p>${product.description}</p>
                                    <a href="contact.html" class="btn btn-secondary" style="margin-top: 1rem; width: 100%;">Request Quote</a>
                                </div>
                            `;
                            container.appendChild(card);
                        });

                        currentPage++;
                        isLoading = false;

                        if (hasMore) {
                            container.appendChild(loadingIndicator);
                            observer.observe(loadingIndicator);
                        } else {
                            const endMessage = document.createElement('p');
                            endMessage.className = 'text-center';
                            endMessage.style.gridColumn = '1/-1';
                            endMessage.style.marginTop = '20px';
                            endMessage.textContent = 'You have reached the end of the catalog.';
                            container.appendChild(endMessage);
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching products:', error);
                        isLoading = false;
                        loadingIndicator.textContent = 'Failed to load products. Please try again.';
                        if (loadingIndicator.parentNode !== container) {
                            container.appendChild(loadingIndicator);
                        }
                    });
            }
        });
    </script>
</body>

</html>